Aynen, şimdi sadece **i18n süreci** için saf notları yazıyorum. Bunu direkt `.md` olarak kaydedebilirsin.

````md
# Ensotek i18n Süreci – Tüm Modüller İçin Ortak Pattern

Bu not tüm çok dilli modüller (categories, sub_categories, products, custom_pages, articles, news, blog vs.) için **tek i18n standardı**dır.

---

## 1. Temel Kural: Base ID + Locale

- Her içerik tipi için:
  - **Base tablo**: Dil bağımsız alanlar
    - Ör: `categories`, `products`, `custom_pages`, `articles`
  - **i18n tablo**: Dil’e bağlı alanlar
    - Ör: `category_i18n`, `product_i18n`, `custom_page_i18n`, `article_i18n`

- Ortak kurallar:
  - Base tablo PK: `id` (UUID, CHAR(36))
  - i18n tablo PK: `(base_id, locale)` (ör: `(category_id, locale)`)
  - i18n tablo uniq: `(locale, slug)`
  - **Aynı içeriğin dillerini eşleştirmek için her zaman `base_id + locale` kullanılır.**
  - **Slug hiçbir zaman translation lookup için kullanılmaz.**

---

## 2. Backend i18n Davranışı

### 2.1. Listeleme

- Endpoint şeması (admin):

  ```http
  GET /api/admin/{module}/list?locale=tr&limit=50&offset=0&...
````

* Kurallar:

  * `locale` verilirse: `..._i18n.locale = :locale`
  * `q` araması sadece i18n alanlarında (ör: `name`, `slug`, `title`).
  * Base filtreler (`is_active`, `is_featured` vs.) base tabloya uygulanır.

### 2.2. ID ile Get (locale-aware, ana pattern)

* Endpoint:

  ```http
  GET /api/admin/{module}/{id}?locale=tr
  ```

* Sorgu:

  ```sql
  FROM base
  JOIN base_i18n ON base_i18n.base_id = base.id
  WHERE base.id = :id
    AND base_i18n.locale = :locale
  ```

* `locale` yoksa: `DEFAULT_LOCALE` (ör: `tr`) kullanılır.

> **Bu endpoint + pattern, admin’de locale değiştirmenin ana dayanağı.**

### 2.3. Create

* Body örneği:

  ```json
  {
    "locale": "tr",
    "module_key": "product",
    "name": "Soğutma Kuleleri",
    "slug": "sogutma-kuleleri",
    "description": "...",
    "is_active": true,
    "is_featured": false,
    "display_order": 10
  }
  ```

* Davranış:

  * Base tabloya 1 kayıt (`id` = UUID).
  * i18n tabloya sadece seçilen `locale` için 1 kayıt (`(id, locale)`).
  * Diğer diller create anında otomatik türetilmez.
  * `locale + slug` çakışırsa `409 duplicate_slug`.

### 2.4. Update / Patch (i18n aware)

* Endpoint:

  ```http
  PATCH /api/admin/{module}/{id}
  ```

* Body:

  * Base alanlar: `module_key`, `image_url`, `is_active`, `display_order`…
  * i18n alanlar: `name`, `slug`, `description`, `title`, `alt`, `summary`…

* Kurallar:

  * Body içindeki `locale`, **hangi i18n satırının güncelleneceğini belirler**.
  * `id + locale` için i18n satırı yoksa:

    * Tercih edilen davranış: **UPSERT** (yoksa INSERT, varsa UPDATE).
    * Böylece FE, “ilk kez bu dilde kaydetme” işlemini sadece `PATCH/PUT` ile yapabilir.

### 2.5. Toggle / Flags

* `is_active`, `is_featured`, `image_url`, vs. **base tablo alanlarıdır.**

* Endpoint:

  ```http
  PATCH /api/admin/{module}/{id}/active?locale=en
  ```

* Uygulama:

  * DB’de sadece base tablo güncellenir.
  * Response dönerken:

    * `?locale` verilmişse o dile göre view oluşturulur.
    * Yoksa default locale’deki view döner.

---

## 3. Frontend (RTK + Form) i18n Pattern

### 3.1. RTK – ID ile Get

Her modülde:

```ts
getXAdmin: build.query<XDto, { id: string; locale?: string }>({
  query: ({ id, locale }) => ({
    url: `/admin/x/${encodeURIComponent(id)}`,
    method: "GET",
    params: cleanParams(locale ? { locale } : undefined),
  }),
});
```

Örnekler:

* `getCategoryAdmin: { id: string; locale?: string }`
* `getProductAdmin: { id: string; locale?: string }`
* `getSubCategoryAdmin: { id: string; locale?: string }`
* `getCustomPageAdmin: { id: string; locale?: string }`

> **Tek parametreli `getX(id: string)` endpoint yok.**
> Her zaman `id + locale` alan bir tip kullan.

### 3.2. Admin Form State

Form state’te:

* Base id: `id` / `page_id` / `group_id` / `category_id` vs.
* Aktif dil: `locale`

Örnek:

```ts
type FormState = {
  id?: string;        // base id (tüm diller ortak)
  locale: string;     // aktif dil
  name: string;
  slug: string;
  description: string;
  ...
};
```

### 3.3. Locale Değiştirme Akışı (genel)

1. Kullanıcı locale dropdown’dan yeni dil seçer (`nextLocale`).
2. **Create modunda**:

   * Sadece `formState.locale = nextLocale`.
3. **Edit modunda**:

   * `baseId` = `initialData.id` veya `formState.id` veya `page_id`/`group_id`.

   * RTK ile:

     ```ts
     const row = await triggerGetX({ id: baseId, locale: nextLocale }).unwrap();
     ```

   * Eğer kayıt dönerse:

     * `formState = mapDtoToFormState(row)`
       (tüm alanlar yeni dildeki kayıtla doldurulur).

   * Eğer 404 gelirse:

     * `formState.locale = nextLocale`
     * `formState.id` aynı base id’ye bağlı kalır.
     * Kullanıcı kaydedince backend `id + locale` için i18n satırını yaratır (UPSERT).

> **Altın Kural:**
> Locale değiştirirken **translation lookup için slug, name, title, q, vs. kullanılmaz**.
> Tek doğru anahtar: **base id + locale**.

---

## 4. Slug Kullanımı

* Slug:

  * Her dilde farklı olabilir (`hizmetler`, `services`, `servicios`, …).
  * i18n tabloda tutulur, `(locale, slug)` unique index ile korunur.
* Slug sadece:

  * Public routing (SEO URL),
  * `GET /by-slug/:slug?locale=xx` gibi **tek dil odaklı** endpoint’lerde kullanılır.
* **Slug asla diller arası eşleşme yapmak için kullanılmaz.**

---

## 5. Yeni Modül Açarken i18n Check-List

Yeni bir i18n’li modül oluştururken:

1. **DB**

   * [ ] Base tablo + i18n tablo kuruldu mu?
   * [ ] i18n PK `(base_id, locale)` mi?
   * [ ] `(locale, slug)` için unique index var mı?
   * [ ] FK + ON DELETE CASCADE var mı?

2. **Backend**

   * [ ] `GET /list` locale destekli mi?
   * [ ] `GET /:id` id+locale destekli mi?
   * [ ] Create sadece bir locale için kayıt açıyor mu?
   * [ ] Update/Patch base + i18n alanları doğru tabloda güncelliyor mu?
   * [ ] `id + locale` için i18n UPSERT mantığı net mi?

3. **RTK**

   * [ ] `getXAdmin` argümanı `{ id: string; locale?: string }` mi?
   * [ ] List query tiplerinde `locale` alanı var mı?

4. **Form**

   * [ ] Form state’te base id + locale tutuluyor mu?
   * [ ] Locale switch handler’ı **her zaman** `id + locale` ile backend’i çağırıyor mu?
   * [ ] Locale switch’te slug/name ile arama yapılmıyor mu?

Bu pattern tüm modüllerde uygulandığında:

* Locale değişiminde “yanlış içerik/yanlış dil/slug karışıklığı” bitmiş olur.
* Yeni modul açarken i18n davranışı düşünmek yerine bu notu referans almak yeterli olur.

```
```
